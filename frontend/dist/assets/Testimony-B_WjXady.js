import{r as n,R as e,d as w}from"./index-B9rpfc-n.js";import{g as P,c as N,a as R}from"./index.esm2017-B08gBLUz.js";const U="https://api.cloudinary.com/v1_1/do1kqxdpm/image/upload",Y="do1kqxdpm",_=()=>{const[g,y]=n.useState([]),[s,h]=n.useState(""),[v,u]=n.useState(!1),[r,f]=n.useState({date:"",name:"",imgUrl:"",text:"",testimonyTitle:"",location:"",approved:!1}),[p,x]=n.useState(!1),[b,E]=n.useState([]),[T,i]=n.useState(!1);n.useEffect(()=>{(async()=>{const l=(await P(N(w,"testimonies"))).docs.map(o=>({id:o.id,...o.data()}));y(l)})()},[]);const c=t=>{const{name:a,value:l}=t.target;f(o=>({...o,[a]:l}))},S=async t=>{const a=t.target.files[0];if(!a)return;const l=new FormData;l.append("file",a),l.append("upload_preset",Y);try{const m=await(await fetch(U,{method:"POST",body:l})).json();f(d=>({...d,imgUrl:m.secure_url}))}catch(o){console.error("Error uploading image:",o)}},C=async()=>{if(p)return;x(!0);const{date:t,name:a,text:l}=r;if(!t||!a||!l){alert("Please provide Date, Your Name, and Your Testimony."),x(!1);return}try{const o=new Date(t).toISOString(),m=await R(N(w,"testimonies"),{...r,date:o});y(d=>[...d,{id:m.id,...r,date:o}]),u(!1),f({date:"",name:"",imgUrl:"",text:"",testimonyTitle:"",location:"",approved:!1})}catch(o){console.error("Error adding testimony:",o)}finally{x(!1)}},k=g.filter(t=>t.approved).filter(t=>{if(!s)return!0;const a=s.toLowerCase();return t.name.toLowerCase().includes(a)||t.text.toLowerCase().includes(a)||t.testimonyTitle&&t.testimonyTitle.toLowerCase().includes(a)}).sort((t,a)=>new Date(a.date)-new Date(t.date));n.useEffect(()=>{if(s.trim()===""){E([]),i(!1);return}const t=s.toLowerCase(),a=g.filter(l=>l.approved).filter(l=>l.name.toLowerCase().includes(t)||l.testimonyTitle&&l.testimonyTitle.toLowerCase().includes(t)).slice(0,5);E(a),i(!0)},[s,g]);const D=t=>{h(t.name),i(!1)};return e.createElement("div",{className:"bg-gray-50 min-h-screen"},e.createElement("header",{className:"bg-gradient-to-r from-purple-700 to-yellow-400 text-white py-20 px-6"},e.createElement("div",{className:"max-w-3xl mx-auto text-center"},e.createElement("h1",{className:"text-5xl font-extrabold tracking-tight"},"Testimonies of Faith"),e.createElement("p",{className:"mt-4 text-lg italic"},"“Let the redeemed of the Lord say so.” – Psalm 107:2"))),e.createElement("div",{className:"container mx-auto px-4 py-8 text-center"},e.createElement("button",{onClick:()=>u(!0),className:"inline-flex items-center bg-yellow-400 hover:bg-yellow-500 text-purple-800 font-semibold py-3 px-8 rounded-full shadow-lg transition"},"Share Your Praise Report")),e.createElement("div",{className:"container mx-auto px-4 relative max-w-md"},e.createElement("div",{className:"mb-8"},e.createElement("input",{type:"text",placeholder:"Search testimonies...",value:s,onChange:t=>h(t.target.value),onFocus:()=>{b.length>0&&i(!0)},onBlur:()=>setTimeout(()=>i(!1),150),className:"w-full p-3 border-2 border-purple-300 rounded-lg focus:outline-none focus:border-purple-500"}),T&&b.length>0&&e.createElement("ul",{className:"absolute z-10 bg-white border border-purple-300 rounded-lg w-full mt-1 max-h-60 overflow-y-auto shadow-lg"},b.map(t=>e.createElement("li",{key:t.id,className:"px-4 py-2 cursor-pointer hover:bg-purple-100",onClick:()=>D(t)},e.createElement("strong",null,t.name),t.testimonyTitle?` - ${t.testimonyTitle}`:""))))),e.createElement("div",{className:"container mx-auto px-4 pb-16"},e.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"},k.map(({id:t,name:a,testimonyTitle:l,location:o,imgUrl:m,text:d,date:L})=>e.createElement("div",{key:t,className:"bg-white rounded-2xl shadow-xl p-6 relative overflow-hidden"},e.createElement("div",{className:"absolute top-4 right-4 text-yellow-400 text-6xl opacity-20"},"“"),e.createElement("div",{className:"flex items-center mb-4"},m&&e.createElement("img",{src:m,alt:a,className:"w-14 h-14 rounded-full border-2 border-purple-200 object-cover mr-4"}),e.createElement("div",null,e.createElement("h3",{className:"text-xl font-bold text-purple-800"},a),l&&e.createElement("p",{className:"text-sm text-purple-600"},l),o&&e.createElement("p",{className:"text-xs text-gray-500"},o))),e.createElement("p",{className:"text-gray-700 leading-relaxed mb-4 whitespace-pre-wrap"},d),e.createElement("p",{className:"text-right text-sm text-gray-400"},new Date(L).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})))))),v&&e.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex justify-center items-start pt-24 px-4 z-50",onClick:()=>u(!1)},e.createElement("div",{className:"bg-white w-full max-w-lg max-h-[90vh] overflow-y-auto rounded-xl shadow-2xl p-6 relative",onClick:t=>t.stopPropagation()},e.createElement("h2",{className:"text-2xl font-bold text-purple-800 mb-4"},"Share Your Praise Report"),e.createElement("form",{className:"space-y-4"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1"},"Date of Testimony *"),e.createElement("input",{type:"date",name:"date",value:r.date,onChange:c,className:"w-full p-2 border border-gray-300 rounded-lg",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1"},"Your Name *"),e.createElement("input",{type:"text",name:"name",value:r.name,onChange:c,className:"w-full p-2 border border-gray-300 rounded-lg",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1"},"Testimony Title"),e.createElement("input",{type:"text",name:"testimonyTitle",value:r.testimonyTitle,onChange:c,className:"w-full p-2 border border-gray-300 rounded-lg"})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1"},"Location"),e.createElement("input",{type:"text",name:"location",value:r.location,onChange:c,className:"w-full p-2 border border-gray-300 rounded-lg"})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1"},"Your Testimony *"),e.createElement("textarea",{name:"text",value:r.text,onChange:c,rows:"4",className:"w-full p-2 border border-gray-300 rounded-lg",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1"},"Photo (optional)"),e.createElement("input",{type:"file",accept:"image/*",onChange:S,className:"w-full"}),r.imgUrl&&e.createElement("img",{src:r.imgUrl,alt:"Preview",className:"mt-2 w-24 h-24 rounded-lg object-cover"})),e.createElement("div",{className:"flex justify-end pt-4"},e.createElement("button",{type:"button",onClick:C,disabled:p,className:`bg-purple-700 hover:bg-purple-800 text-white py-2 px-6 rounded-full font-semibold transition ${p?"opacity-50 cursor-not-allowed":""}`},p?"Submitting...":"Submit Testimony"))),e.createElement("button",{onClick:()=>u(!1),className:"absolute top-4 right-4 text-purple-700 font-bold text-2xl leading-none","aria-label":"Close modal"},"×"))))};export{_ as default};
